
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Membrane segmentation in cryo-electron tomography data.">
      
      
        <meta name="author" content="teamtomo">
      
      
        <link rel="canonical" href="https://teamtomo.org/membrain-seg/Usage/Segmentation/">
      
      
        <link rel="prev" href="../Preprocessing/">
      
      
        <link rel="next" href="../Training/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Segmentation - membrain-seg</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#segmentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="membrain-seg" class="md-header__button md-logo" aria-label="membrain-seg" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15 6.04 7.5 12 10.85l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            membrain-seg
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Segmentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/teamtomo/membrain-seg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    teamtomo/membrain-seg
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="membrain-seg" class="md-nav__button md-logo" aria-label="membrain-seg" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15 6.04 7.5 12 10.85l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg>

    </a>
    membrain-seg
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/teamtomo/membrain-seg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    teamtomo/membrain-seg
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MemBrain-seg
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to create training annotations from your own dataset?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmarking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fine-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fine-tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Segmentation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Segmentation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#membrain-seg-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      MemBrain-seg Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparations" class="md-nav__link">
    <span class="md-ellipsis">
      Preparations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Prediction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prediction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-membrain-segment-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      more membrain segment arguments:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note2" class="md-nav__link">
    <span class="md-ellipsis">
      Note#2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emergency-tip" class="md-nav__link">
    <span class="md-ellipsis">
      Emergency tip:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on-the-fly-rescaling" class="md-nav__link">
    <span class="md-ellipsis">
      On-the-fly rescaling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connected-components" class="md-nav__link">
    <span class="md-ellipsis">
      Connected components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connected components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_1" class="md-nav__link">
    <span class="md-ellipsis">
      Note:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-thresholding" class="md-nav__link">
    <span class="md-ellipsis">
      Custom thresholding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeletonization" class="md-nav__link">
    <span class="md-ellipsis">
      Skeletonization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Processing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#membrain-seg-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      MemBrain-seg Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparations" class="md-nav__link">
    <span class="md-ellipsis">
      Preparations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Prediction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prediction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-membrain-segment-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      more membrain segment arguments:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note2" class="md-nav__link">
    <span class="md-ellipsis">
      Note#2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emergency-tip" class="md-nav__link">
    <span class="md-ellipsis">
      Emergency tip:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on-the-fly-rescaling" class="md-nav__link">
    <span class="md-ellipsis">
      On-the-fly rescaling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connected-components" class="md-nav__link">
    <span class="md-ellipsis">
      Connected components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connected components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note_1" class="md-nav__link">
    <span class="md-ellipsis">
      Note:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-thresholding" class="md-nav__link">
    <span class="md-ellipsis">
      Custom thresholding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skeletonization" class="md-nav__link">
    <span class="md-ellipsis">
      Skeletonization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Processing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="segmentation">Segmentation</h1>
<p>Welcome to the central feature of MemBrain-seg: <strong>The segmentation of your tomograms!</strong></p>
<p>This guide provides detailed instructions to perform segmentation on your tomograms using a pre-trained model.</p>
<h2 id="membrain-seg-workflow">MemBrain-seg Workflow</h2>
<ol>
<li>(Optional) <a href="../Preprocessing/">Preprocessing</a><ul>
<li>pixel size matching</li>
<li>Fourier amplitude matching</li>
</ul>
</li>
<li><strong>Predict segmentation</strong></li>
<li>(Optional) <a href="../Preprocessing/#pixel-size-matching">Match pixel size</a> of output segmentation</li>
</ol>
<p>For the optional preprocessing steps, find more information <a href="../Preprocessing/">here</a></p>
<h2 id="preparations">Preparations</h2>
<p>For the prediction, you will basically need two files:</p>
<ol>
<li>The <strong>tomogram</strong> you would like to segment.<br />
It may make sense to use a preprocessed tomogram.</li>
<li>A <strong>pre-trained MemBrain segmentation model</strong></li>
</ol>
<p>We recommend to use denoised (ideally Cryo-CARE<sup>1</sup>) tomograms for segmentation. However, our current best model is available for download <a href="https://drive.google.com/file/d/1hruug1GbO4V8C4bkE5DZJeybDyOxZ7PX/view?usp=sharing">here</a> and should also work on non-denoised data. Please let us know how it works for you.
If the given model does not work properly, you may want to try one of our previous versions:</p>
<p>Other (older) model versions:
- <a href="https://drive.google.com/file/d/1tSQIz_UCsQZNfyHg0RxD-4meFgolszo8/view?usp=sharing">v10_alpha -- standard model until 24th April 2025</a>
- <a href="https://drive.google.com/file/d/15ZL5Ao7EnPwMHa8yq5CIkanuNyENrDeK/view?usp=sharing">v9 -- best model until 10th Aug 2023</a>
- <a href="https://drive.google.com/file/d/1TGpQ1WyLHgXQIdZ8w4KFZo_Kkoj0vIt7/view?usp=sharing">v9b -- model for non-denoised data until 10th Aug 2023</a></p>
<p>Please note that our best model changes often, as we are still in the development phase. So you can check in from time to time and see whether the model improved.
If you have problems with the model, please write an email to lorenz.lamm@helmholtz-munich.de</p>
<div class="highlight"><pre><span></span><code>[1] T. -O. Buchholz, M. Jordan, G. Pigino and F. Jug, &quot;Cryo-CARE: Content-Aware Image Restoration for Cryo-Transmission Electron Microscopy Data,&quot; 2019 IEEE 16th International Symposium on Biomedical Imaging (ISBI 2019), Venice, Italy, 2019, pp. 502-506, doi: 10.1109/ISBI.2019.8759519.
</code></pre></div>
<h2 id="prediction">Prediction</h2>
<p>Typing
<div class="highlight"><pre><span></span><code>membrain segment
</code></pre></div>
will display the segmentation command line interface and show available options.</p>
<p align="center" width="100%">
    <img width="50%" src="https://user-images.githubusercontent.com/34575029/250504257-611ea864-48c5-4424-9bc8-7b30bcfbb39b.png">
</p>

<p>For example, for the prediction, you only need to type</p>
<div class="highlight"><pre><span></span><code>membrain<span class="w"> </span>segment<span class="w"> </span>--tomogram-path<span class="w"> </span>&lt;path-to-your-tomo&gt;<span class="w"> </span>--ckpt-path<span class="w"> </span>&lt;path-to-your-model&gt;<span class="w"> </span>--rescale-patches
</code></pre></div>
<p>Running this will segment your tomogram, and store the resulting .mrc file into the ./predictions 
folder. The <code>--rescale-patches</code> flag is important to rescale your tomogram to our training pixel size
of 10 Angstrom. If your header information (pixel size) is corrupt, make sure to manually pass the
correct pixel size with <code>--in-pixel-size</code>.</p>
<p>If you would like to change the output folder, you can simply specify another folder using
the <code>--out_folder</code> argument:</p>
<div class="highlight"><pre><span></span><code>membrain<span class="w"> </span>segment<span class="w"> </span>--tomogram-path<span class="w"> </span>&lt;path-to-your-tomo&gt;<span class="w"> </span>--ckpt-path<span class="w"> </span>&lt;path-to-your-model&gt;<span class="w"> </span>--out-folder<span class="w"> </span>&lt;your-preferred-folder&gt;<span class="w"> </span>--rescale-patches
</code></pre></div>
<p>It is now also possible to assign different labels to different membrane instances via computing connected components and also remove small connected components:
<div class="highlight"><pre><span></span><code>membrain<span class="w"> </span>segment<span class="w"> </span>--tomogram-path<span class="w"> </span>&lt;path-to-your-tomo&gt;<span class="w"> </span>--ckpt-path<span class="w"> </span>&lt;path-to-your-model&gt;<span class="w"> </span>--store-connected-components<span class="w"> </span>--rescale-patches
</code></pre></div></p>
<p>You can also compute the connected components <a href="#connected-components">after you have segmented your tomogram</a>.</p>
<h3 id="more-membrain-segment-arguments">more membrain segment arguments:</h3>
<p><strong>--tomogram-path:</strong> Path to the tomogram to be segmented [default: None] </p>
<p><strong>--ckpt-path:</strong> Path to the pre-trained model checkpoint that should be used. [default: None] </p>
<p><strong>--out-folder:</strong> Path to the folder where segmentations should be stored. [default: ./predictions]</p>
<p><strong>--rescale-patches / --no-rescale-patches:</strong> Should patches be rescaled on-the-fly during inference?</p>
<p><strong>--in-pixel-size</strong>: pixel size of your tomogram (only important if --rescale-patches flag is set)</p>
<p><strong>--out-pixel-size</strong>: pixel size to which patches will be rescaled internally (should normally be 10)</p>
<p><strong>--store-probabilities / --no-store-probabilities</strong>: Should probability maps be output in addition to segmentations? [default: no-store-probabilities]</p>
<p><strong>--store-connected-components / no-store-connected-components</strong>: Should connected components of the segmentation be computed? [default: no-store-connected-components]  </p>
<p><strong>--connected-component-thres</strong>: Threshold for connected components. Components smaller than this will be removed from the segmentation. [default: None]</p>
<p><strong>--test-time-augmentation / --no-test-time-augmentation</strong>: Should 8-fold test time augmentation be used? If activated (default), segmentations tendo be slightly better, but runtime is increased.</p>
<p><strong>--segmentation-threshold</strong>: Set a custom threshold for thresholding your membrane scoremap to increase / decrease segmented membranes (default: 0.0).</p>
<p><strong>--sliding-window-size</strong> INTEGER Sliding window size used for inference. Smaller values than 160 consume less GPU, but also lead to worse segmentation results! [default: 160] </p>
<p><strong>--help</strong> Show this message and exit.     </p>
<h3 id="note">Note:</h3>
<p>MemBrain-seg automatically detects a CUDA-enabled GPU, if available, and will execute the segmentation on it. Using a GPU device is highly recommended to accelerate the segmentation process.</p>
<h3 id="note2">Note#2:</h3>
<p>Running MemBrain-seg on a GPU requires at least roughly 8GB of GPU space.</p>
<h3 id="emergency-tip">Emergency tip:</h3>
<p>In case you don't have enough GPU space, you can also try adjusting the <code>--sliding-window-size</code> parameter. By default, it is set to 160. Smaller values will require less GPU space, but also lead to worse segmentation results!</p>
<h2 id="on-the-fly-rescaling">On-the-fly rescaling</h2>
<p>Since v0.0.2, we provide the option to rescale patches on-the-fly during inference. That means, if your tomogram pixel size is very different from our training pixel size (10Angstrom), you do not need to rescale your tomograms to the correponding pixel size in advance.</p>
<p>Instead, you can set the <code>--rescale-patches</code> flag and membrain-seg will do everything for you internally. </p>
<p>Example: Your tomogram has pixel size 17.92:
<div class="highlight"><pre><span></span><code>membrain<span class="w"> </span>segment<span class="w"> </span>--tomogram-path<span class="w"> </span>&lt;path-to-your-tomo&gt;<span class="w"> </span>--ckpt-path<span class="w"> </span>&lt;path-to-your-model&gt;<span class="w"> </span>--rescale-patches<span class="w"> </span>--in-pixel-size<span class="w"> </span><span class="m">17</span>.92
</code></pre></div></p>
<p>This will rescale small patches of your tomogram internally to 10A, feed them into our network, and scale back to the original pixel size. That means, your output segmentation mask corresponds directly to your input tomogram.</p>
<p>Note: MemBrain-seg automatically reads teh pixel size also from your tomogram header. That means, you only need to pass the <code>--in-pixel-size</code> flag if your header is corrupt, e.g. after processing in Cryo-CARE.</p>
<h2 id="connected-components">Connected components</h2>
<p>If you have segmented your tomograms already, but would still like to extract the connected components of the segmentation, you don't need to re-do the segmentation, but can simply use the following command:
<div class="highlight"><pre><span></span><code>membrain<span class="w"> </span>components<span class="w"> </span>--segmentation-path<span class="w"> </span>&lt;path-to-your-segmentation&gt;<span class="w"> </span>--connected-component-thres<span class="w"> </span><span class="m">50</span><span class="w"> </span>--out-folder<span class="w"> </span>&lt;folder-to-store-components&gt;
</code></pre></div></p>
<h3 id="note_1">Note:</h3>
<p>Computing the connected components, and particularly also removing the small components can be quite compute intensive and take a while.</p>
<h2 id="custom-thresholding">Custom thresholding</h2>
<p>In some cases, the standard threshold (<span class="arithmatex">\(0.0\)</span>) may not be the ideal value for segmenting your tomograms. In order to explore what threshold may be best, you can use the above segmentation command with the flag <code>--store-probabilities</code>. This will store a membrane scoremap that you can threshold using different values using the command:</p>
<p><div class="highlight"><pre><span></span><code>membrain thresholds --scoremap-path &lt;path-to-scoremap&gt;
        --thresholds -1.5 --thresholds -0.5 --thresholds 0.0 --thresholds 0.5
</code></pre></div>
In this way, you can pass as many thresholds as you would like and the function will output one segmentation for each.</p>
<h2 id="skeletonization">Skeletonization</h2>
<p>It is now also possible to generate a skeletonized version of the membrane segmentations, similar to the output of <a href="https://github.com/anmartinezs/pyseg_system/tree/master/code/tomosegmemtv">TomoSegMemTV</a>.</p>
<p>For this, you can ue the <code>membrain skeletonize</code> command:
<div class="highlight"><pre><span></span><code>membrain<span class="w"> </span>skeletonize<span class="w"> </span>--label-path<span class="w"> </span>&lt;path-to-your-segmentation&gt;
</code></pre></div></p>
<p>You only need to input the path to the segmentation that has been generated my MemBrain-seg. The output of this function will be a skeletonized version of this.</p>
<h2 id="post-processing">Post-Processing</h2>
<p>If you have pre-processed your tomogram using pixel size matching, you may want to <a href="../Preprocessing/#pixel-size-matching">rescale</a> your 
segmentation back to the shape of the original tomogram.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2022 teamtomo
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight", "search.suggest", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>